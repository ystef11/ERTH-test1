Общее описание
-----------
docker-compose.yml эмулирует работу всей цепочки обработки очереди платежей.
Для примера некоторые контейнеры собираются в compose, некоторые собраны и залиты в хаб.
Логика работы описана ниже по компонентам:
+ [db](#db)
+ [phpmyadmin](#phpmyadmin)
+ [restapi](#restapi)
+ [main](#main)

Запуск 
```
docker compose up
```
Для тестирования работы необходимо запустить контейнеры, подключиться к phpmyadmin и наблюдать как меняются статусы в таблице sbp.payments
```
SELECT count(1) FROM sbp.payments where status <> 'ERROR';
```

### <a name="db"></a>db
Сервис MySQL с базой данных тестовых плетежей
В стартовой таблице sbp.payments находится 100 платежей со статусом ERROR
По завершению работы сервиса main все записи должны перейти в статус ACWP (успех)

### <a name="phpmyadmin"></a>phpmyadmin
Админка для просмотра содержимого БД
логин/пароль: admin/admin

### <a name="restapi"></a>restapi
Сервер, эмулирующий работу сервера СБП, в частности метода /payment/v2/qrc-status
Отвечает случайным образом по статусам платежей. Для упрощения часть с аутентификацией не реализовывал, к тому же она отличается для разных клиентов СБП.

### <a name="main"></a>main
Основной сервис обработки очереди платежей. Реализовано максимально упрощенно, без оптимизаций и обработчиков ошибок. 
Для примера запускается в двух экземплярах, но возможно любое горизонтальное масштабирование.
Рабочий скрипт /app/main.py.
Сервис работает в цикле по следующему алгоритму:
1. Получает идентифкатор ноды запросом в БД
2. Резервирует за собой в БД пачку qrcId на обработку (проставляет на записях номер ноды)
2. Вызывает метод СБП /payment/v2/qrc-status со списком qrcId
3. Обновляет статусы платежей в БД
4. Делает паузу в 2 секунды, чтобы проще было наблюдать изменения в БД

